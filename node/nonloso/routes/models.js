var express = require('express');
const Model = require('../data/model');
var router = express.Router();
var sqlite3 = require('sqlite3').verbose();
var sqlite = require('sqlite');
 

/* GET users listing. */
router.get('/', async function(req, res, next) {

    const models_ids = await sqlite.open({
        filename: '/home/princio/Desktop/malware_detection/models/database.sqlite3',
        driver: sqlite3.Database
    })
    .then(db => db.all("SELECT id FROM models"))
    .catch(error => console.log(error));

    let models = await Promise.all(models_ids.map(model_id => Model.fetch(model_id.id)));

    res.render('models', {models});
    
});

router.get('/:id', async function(req, res, next) {
    const model = await Model.fetch(req.params.id);

    await model.fetch_reports();

    res.render('models/model', {model});
});

module.exports = router;
