var express = require('express');
var router = express.Router();

const fs = require('fs')

function scan_dir(type)
{
    const files = [];

    let dir = fs.opendirSync(__dirname + '/../../../datasets/' + type + '_h_t');
    while (true)
    {
        const file = dir.readSync();
        if(file === null) break;

        let matches = /(\d+)_(\d{4}\-\d{2}\-\d{2})_([\w\-]+)\.([\w\_]+)\.csv.*/.exec(file.name);

        console.log(matches);

        if(matches === null)
        {
            matches = [ file.name, -1, undefined, undefined, undefined ];
        }

        files.push({
            name: matches[0],
            index: Number.parseInt(matches[1]),
            date: matches[2],
            infos: matches[3],
            capturer: matches[4]
        });
    }

    return files;
}

/* GET home page. */
router.get('/', function(req, res, next) {

    const files = { benign: [], malign: [] };

    console.log(__dirname);

    files.benign = scan_dir('benign');
    files.malware = scan_dir('malware');

    res.render('test', { title: 'Test', files });
});

router.post('/:dataset_name', function(req, res, next) {

    console.log(req.params.dataset_name);

    res.send('Ã¨ andata be');
});

module.exports = router;
