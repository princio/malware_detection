var express = require('express');
var router = express.Router();
var fs = require('fs')
const { Client } = require('pg');
const Model = require('../data/model');
const Dataset = require('../data/dataset');
const Report = require('../data/report');
const Repository = require('../data/repository');
const { ModelRepository } = require('../data/repository');
const { DatasetRepository } = require('../data/repository');
const { ReportRepository } = require('../data/repository');
const client = new Client()


/* GET home page. */
router.get('/', async function(req, res, next) {

  client.connect()
  const models = (await client.query('SELECT id FROM models')).rows.reduce((obj, row) => { return {...obj, [row.id]: ModelRepository.fetch(row[0]) }}, {});
  const datasets = (await client.query('SELECT id FROM datasets')).rows.reduce((obj, row) => { return {...obj, [row.id]: DatasetRepository.fetch(row[0]) }}, {});
  const reports = (await client.query('SELECT id FROM reports')).rows.reduce((obj, row) => { return {...obj, [row.id]: ReportRepository.fetch(row[0]) }}, {});

  console.log(Object.values(reports)[0].metrics);
  res.render('index', { title: 'Test', models, reports, datasets });
});

module.exports = router;
