#include <stdio.h>
#include <pcap.h>


void my_packet_handler(
    u_char *args,
    const struct pcap_pkthdr *header,
    const u_char *packet
)
{
}

int main(int argc, char **argv) {


    struct bpf_program filter;
    char filter_expression[] = "dns";
    bpf_u_int32 subnet_mask, ip;


    char error_buffer[PCAP_ERRBUF_SIZE];
    pcap_t *handle = pcap_open_offline("capture_file.pcap", error_buffer);

    if (handle == NULL) {
        printf("Could not open %s - %s\n", "capture_file.pcap", error_buffer);
        return 2;
    }
    if (pcap_compile(handle, &filter, filter_expression, 0, ip) == -1) {
        printf("Bad filter - %s\n", pcap_geterr(handle));
        return 2;
    }
    if (pcap_setfilter(handle, &filter) == -1) {
        printf("Error setting filter - %s\n", pcap_geterr(handle));
        return 2;
    }


    u_char *my_arguments = NULL;
    pcap_loop(handle, 10, my_packet_handler, my_arguments);


    pcap_close(handle);
    
    return 0;
}