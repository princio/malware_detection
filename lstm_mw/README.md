# LSTM_MW

In project folder (with setup.py):
```
pip install .
```

After that, install tensorflow or tensorflow-gpu and keras:
```
pip install tensorflow[-gpu] keras
```

## Execute predictions directly from pcaps

The program get a pcap file, parse it and generate as output a .csv file.
/path/filename.pcap --> /path/filename.pcap.csv

Until the processing is not completed:
/path/filename.pcap --> /path/filename.pcap.csv.progress

LSTM NN available:
- nosfx
- domain

Works with single pcap input or with directories, searching pcap files inside them.

If /path/filename.pcap.csv exists, no process will be done. To force re-process, pass --redo option.


```
python3  -m lstm_mw               ./tests/8-1_2016-09-13_win16.pcap
python3  -m lstm_mw  --no-fast    ./tests/8-1_2016-09-13_win16.pcap 

python3  -m lstm_mw      ./tests/8-1_2016-09-13_win16.pcap  --outdir ./tests/outdirerror
python3  -m lstm_mw  -R  ./tests
python3  -m lstm_mw  -R --no-fast --no-domain ./tests/  --outdir ./tests/outdir
```

An *output dir* can be specified, output files will be saved in this folder.

## Models
Both model will be used, with options --no-nosfx or --no-domain you can exclude them.

## Fast mode

Much faster than normal mode, enabled by default, it take advantage of a special function of PyShark.

Fast mode fields:
> frame_number, timestamp, qry_name, response

Normal mode fields:
> frame_number, timestamp, count_labels, count_queries, flags_authenticated, flags_response, qry_name, qry_type, qry_class,resp_ttl, resp_name, response_to, time, a, aaaa

## Legitness

Add a column called `legit_dsfx` if the domain+suffix belongs to the top 10 millions domains.

## Buffer size

Pyshark parsed packets are not kept in memory, but the data extracted from them is kept on memory until buffer_size is reached.

When buffer_size is reached, the extracted data will be flushed to disk in a '.csv.progress' file.

Default value: 0 (infinite buffer)

Option: --buffer NUM_PKT

## Timeout

A timeout for each pcap file parsing, and not the sum of them all.

Option: --timeout SECONDS

## Packet number

A threshold indicating the maxinum number of packet to be parsed, starting always from the first.

Option: --pkt_num PKT_NUM
