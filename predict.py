import psycopg2
import os, json
from Model import Model
from Pcap import Pcap
from Repository import ModelRepository
from math import log
import numpy as np
import matplotlib.pyplot as plt
import math

plt.set_loglevel("warning")

connection = psycopg2.connect(user = "postgres",
                                  password = "porcodio",
                                  host = "127.0.0.1",
                                  port = "5432",
                                  database = "malware")

def format_defected(x):
    x = x.split('.')
    return x[0] + x[-1]

def format_whole(x):
    return x.replace('.', '')

def predict():
    id_mio = 'fb9ffddd-de28-439c-8ae5-3473f390e6cf'
    id_granatiero = 'c62c1bed-722f-4a7e-b0a8-09d2b50e9732'
    model = ModelRepository.fetch(connection, id_granatiero)

    inputs = '2542116.fls.doubleclick.net,dwgyu36up6iuz.cloudfront.net,4798504.fls.doubleclick.net,clients2.googleusercontent.com,armmf.adobe.com,download.skype.com,evcs-ocsp.ws.symantec.com,gtssl-ocsp.geotrust.com,www.manchesteronline.co.uk,dy48bnzanqw0v.cloudfront.net,dnkzzz1hlto79.cloudfront.net,adclick.g.doubleclick.net,clients2.google.com,r2---sn-2gb7ln7l.gvt1.com,tools.google.com,sw.symcd.com,dff7tx5c2qbxc.cloudfront.net,ardownload.adobe.com,securepubads.g.doubleclick.net,www.independent.co.uk,r13---sn-25g7sm7r.c.pack.google.com'
    inputs = inputs.split(',')
    
    model.predict(inputs, '/tmp/0_defected.csv', format_defected)
    model.predict(inputs, '/tmp/0_whole.csv', format_whole)
        
    pass

if __name__ == "__main__":
    predict()


    # for delta in [3,5]:
    #     print("delta=%d" % delta)
    #     for z in range(13-delta + 1):
    #         for i in range(z, z + delta):
    #             print("%5d %5d" % (z, i))
    #         print("----")

    pass