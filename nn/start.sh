#! /bin/sh

image="mwdb-trainer"
dockerfile="./dockerfiles/trainer/Dockerfile"

echo $1
case "$1" in
    start)
        docker run -u $(id -u):$(id -g) --network="host" -it \
                --mount type=bind,source="$(pwd)"/models/,target=/trainer/models \
                --rm --runtime=nvidia  "$image" \
                "$2"
        ;;
    build)
        docker build -f "$dockerfile" -t "$image" .
        ;;
    restart)
        docker build -f "$dockerfile" -t "$image" .
        docker run -u $(id -u):$(id -g) --network="host" -it \
                --mount type=bind,source="$(pwd)"/models/,target=/trainer/models \
                --rm --runtime=nvidia  "$image" \
                "$2"
        ;;
    bash)
        docker run -u $(id -u):$(id -g) --network="host" -it \
                --entrypoint /bin/bash \
                --mount type=bind,source="$(pwd)"/models/,target=/trainer/models \
                --rm --runtime=nvidia  "$image" \
                "$2"
        ;;
    help)
    echo "
usage: start.sh [start|build|restart] [transformer-name]

Options:
- transformer-name:
    DOMAIN
    DOMAIN_SFX
    DOMAIN_SFX_NP
    LAST
    LAST_SFX
    LAST_SFX_NP
    NOSFX
    NOSFX_NP
    ANY
    ANY_NP
    SUBDOMAIN
    SUBDOMAIN_NP
    SUBDOMAIN_SFX
    SUBDOMAIN_SFX_NP
"
        ;;
esac
