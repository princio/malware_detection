




from function_f import function_f
from function_l import function_l
from function_p import function_p
from function_s import function_s
from utils import ApplyConfiguration

import os
from pathlib import Path
import pandas as pd


def gen_configs():
    models = [ 7, 8, 9, 10 ]

    wtypes = [ 'llr' ]

    top10ms = [ (0, 0), (1000, -50), (100_000, -50), (1_000_000, -50), (1_000_000, -10) ]

    wsizes = [ 2500, 500, 100 ]

    windowings = [ 'req', 'res', 'both' ]

    infs = [ ( -20, 20 ), ( -20, 200 ), ( -200, 20 ) ]

    outdir = Path('./perform_many/')

    outdir.mkdir(exist_ok=True)

    configs = []
    for model_id in models:
        for wtype in wtypes:
            for top10m in top10ms:
                for wsize in wsizes:
                    for windowing in windowings:
                        for inf in infs:
                            config = ApplyConfiguration(
                                '',
                                model_id,
                                wtype,
                                top10m,
                                wsize,
                                windowing,
                                inf
                            )
                            configs.append(config)
                            pass
    return configs

if __name__ == "__main__":

    nth = 50

    th2s = [ 0.25, 0.75 ]
    
    configs = [
        ApplyConfiguration(name='test1', model_id=7, wtype='llr', top10m=(0,0), wsize=500, windowing='both', inf=(-80, 80)),
        ApplyConfiguration(name='test1', model_id=7, wtype='llr', top10m=(1000, -50), wsize=500, windowing='both', inf=(-80, 80)),
    ]

    configs = gen_configs()

    metricss = []
    for i, config in enumerate(configs):
        print(i)

        _path = f'./perform_many/csvs2/{config.__hash__()}.csv'
        if os.path.exists(_path):
            df_f = pd.read_csv(_path)
        else:
            df_f = function_f(config)
            df_f.to_csv(_path)
        
        cms_ths = function_l(df_f, nth)

        metricss.append(function_p(cms_ths, th2s))

        pass

    compare = function_s(configs, metricss, [ 0 ], [ 'tn2+tp2', 0.75 ], 'top10m')

    pass