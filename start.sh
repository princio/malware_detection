#! /bin/sh

echo "Run only from containing directory!"

image="malware_detection-1"
case "$1" in
    start)
        docker run -u $(id -u):$(id -g) --network="host" -it \
                --mount type=bind,source="$(pwd)"/captures/,target=/trainer/captures \
                --mount type=bind,source="$(pwd)"/predictions/,target=/trainer/predictions \
                --mount type=bind,source="$(pwd)"/models/,target=/trainer/models \
                --mount type=bind,source="$(pwd)"/training/,target=/trainer/training \
                --mount type=bind,source="/tmp",target=/tmp \
                --rm --runtime=nvidia  "$image" \
                "$2"
        ;;
    build)
        docker build -f ./Dockerfiles/gpu/Dockerfile -t "$image" .
        ;;
    restart)
        docker build -f ./Dockerfiles/gpu/Dockerfile -t "$image" .
        docker run -u $(id -u):$(id -g) --network="host" -it \
                --mount type=bind,source="$(pwd)"/captures/,target=/trainer/captures \
                --mount type=bind,source="$(pwd)"/predictions/,target=/trainer/predictions \
                --mount type=bind,source="$(pwd)"/models/,target=/trainer/models \
                --mount type=bind,source="$(pwd)"/training/,target=/trainer/training \
                --mount type=bind,source="/tmp",target=/tmp \
                --rm --runtime=nvidia  "$image" \
                "$2"
        ;;
esac
