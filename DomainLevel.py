from enum import Enum
import tldextract
import pandas as pd



extractor = tldextract.TLDExtract(extra_suffixes=['bit', 'lan'])


def ____________gen_enum():
    a= 'DOMAIN,DOMAIN_SFX,DOMAIN_SFX_NP,'
    a+='SUBDOMAIN,SUBDOMAIN_NP,SUBDOMAIN_SFX,SUBDOMAIN_SFX_NP,'
    a+='NOSFX,NOSFX_NP,'
    a+='WHOLE,WHOLE_NP,'
    a+='SIDE,SIDE_NP'
    a+='FIRSTSUBDOMAIN,FIRSTSUBDOMAIN_SFX,FIRSTSUBDOMAIN_SFX_NP'
    a=a.split(',')
    c=0
    for d in a:
        print(f'{d}={c}')
        c+=1

def ____________test():
    df = pd.DataFrame(['google.co.uk', 'gmail.pish.google.co.uk', 'gmail.pish.google.com', 'google', 'goo.soerfgh'], columns=['dn'])
    for t in Transformer.all():
        df[t.name] = df['dn'].apply(t.translator())
    df=df.T
    df.columns = df.loc['dn']
    print(df.drop('dn', axis=0).to_markdown())

class Transformer(Enum):
    DOMAIN = 0
    DOMAIN_SFX = 1
    DOMAIN_SFX_NP = 2
    LAST = 3
    LAST_SFX = 4
    LAST_SFX_NP = 5
    NOSFX = 6
    NOSFX_NP = 7
    ANY = 8
    ANY_NP = 9
    SUBDOMAIN = 10
    SUBDOMAIN_NP = 11
    SUBDOMAIN_SFX = 12
    SUBDOMAIN_SFX_NP = 13

    @staticmethod
    def dn(dn):
        return extractor(dn.lower().strip()).dn

    @staticmethod
    def dn_sfx(dn):
        exd = extractor(dn.lower().strip())
        return exd.dn + '.' + exd.suffix

    @staticmethod
    def dn_sfx_np(dn):
        exd = extractor(dn.lower().strip())
        return exd.dn + exd.suffix.replace('.','')

    @staticmethod
    def last(dn):
        left = dn.find('.')
        if left == -1:
            return dn
        return dn[:dn.find('.')]

    @staticmethod
    def last_sfx(dn):
        print(dn)
        left = dn.find('.')
        if left == -1:
            return dn
        return dn[:dn.find('.')] + '.' + extractor(dn.lower().strip()).suffix

    @staticmethod
    def last_sfx_np(dn):
        left = dn.find('.')
        if left == -1:
            return dn
        return dn[:dn.find('.')] + extractor(dn.lower().strip()).suffix.replace('.','')

    @staticmethod
    def nosfx(dn):
        suffix_len = 1+len(extractor(dn.lower().strip()).suffix)
        return dn[:-1*suffix_len] if suffix_len > 0 else dn

    @staticmethod
    def nosfx_np(dn):
        suffix_len = 1+len(extractor(dn.lower().strip()).suffix)
        return (dn[:-1*suffix_len] if suffix_len > 0 else dn).replace('.','')

    @staticmethod
    def any(dn):
        return dn

    @staticmethod
    def any_np(dn):
        return dn.replace('.', '')

    @staticmethod
    def subdn(dn):
        return extractor(dn.lower().strip()).subdn

    @staticmethod
    def subdn_np(dn):
        return extractor(dn.lower().strip()).subdn.replace('.', '')

    @staticmethod
    def subdn_sfx(dn):
        exd = extractor(dn.lower().strip())
        return '.'.join([exd.subdn, exd.suffix]) if exd.subdn else exd.suffix

    @staticmethod
    def subdn_sfx_np(dn):
        exd = extractor(dn.lower().strip())
        return (exd.subdn + exd.suffix).replace('.','')

    def translator(self):
        return getattr(Transformer, str(self.name).lower())

    @staticmethod
    def checker(dn, check_suffix = False):
        exd = extractor(dn)
        print(check_suffix, '<%s>' % exd.suffix)
        if exd.suffix == '':
            if check_suffix:
                return False
            print("warning: no suffix for dn |%s|" % dn)
        return dn.find('.') >= 0

    @classmethod
    def all(cls):
        return [member for role, member in cls.__members__.items()]