from enum import Enum
import tldextract
import pandas as pd



extractor = tldextract.TLDExtract(extra_suffixes=['bit', 'lan'])


def ____________gen_enum():
    a= 'DOMAIN,DOMAIN_SFX,DOMAIN_SFX_NP,'
    a+='SUBDOMAIN,SUBDOMAIN_NP,SUBDOMAIN_SFX,SUBDOMAIN_SFX_NP,'
    a+='NOSFX,NOSFX_NP,'
    a+='WHOLE,WHOLE_NP,'
    a+='SIDE,SIDE_NP'
    a+='FIRSTSUBDOMAIN,FIRSTSUBDOMAIN_SFX,FIRSTSUBDOMAIN_SFX_NP'
    a=a.split(',')
    c=0
    for d in a:
        print(f'{d}={c}')
        c+=1

def ____________test():
    df = pd.DataFrame(['google.co.uk', 'gmail.pish.google.co.uk', 'gmail.pish.google.com', 'google', 'goo.soerfgh'], columns=['domain'])
    for t in Transformer.all():
        df[t.name] = df['domain'].apply(t.translator())
    df=df.T
    df.columns = df.loc['domain']
    print(df.drop('domain', axis=0).to_markdown())

class Transformer(Enum):
    DOMAIN = 0
    DOMAIN_SFX = 1
    DOMAIN_SFX_NP = 2
    LAST = 3
    LAST_SFX = 4
    LAST_SFX_NP = 5
    NOSFX = 6
    NOSFX_NP = 7
    ANY = 8
    ANY_NP = 9
    SUBDOMAIN = 10
    SUBDOMAIN_NP = 11
    SUBDOMAIN_SFX = 12
    SUBDOMAIN_SFX_NP = 13

    @staticmethod
    def domain(domain):
        return extractor(domain.lower().strip()).domain

    @staticmethod
    def domain_sfx(domain):
        exd = extractor(domain.lower().strip())
        return exd.domain + '.' + exd.suffix

    @staticmethod
    def domain_sfx_np(domain):
        exd = extractor(domain.lower().strip())
        return exd.domain + exd.suffix.replace('.','')

    @staticmethod
    def last(domain):
        left = domain.find('.')
        if left == -1:
            return domain
        return domain[:domain.find('.')]

    @staticmethod
    def last_sfx(domain):
        print(domain)
        left = domain.find('.')
        if left == -1:
            return domain
        return domain[:domain.find('.')] + '.' + extractor(domain.lower().strip()).suffix

    @staticmethod
    def last_sfx_np(domain):
        left = domain.find('.')
        if left == -1:
            return domain
        return domain[:domain.find('.')] + extractor(domain.lower().strip()).suffix.replace('.','')

    @staticmethod
    def nosfx(domain):
        suffix_len = 1+len(extractor(domain.lower().strip()).suffix)
        return domain[:-1*suffix_len] if suffix_len > 0 else domain

    @staticmethod
    def nosfx_np(domain):
        suffix_len = 1+len(extractor(domain.lower().strip()).suffix)
        return (domain[:-1*suffix_len] if suffix_len > 0 else domain).replace('.','')

    @staticmethod
    def any(domain):
        return domain

    @staticmethod
    def any_np(domain):
        return domain.replace('.', '')

    @staticmethod
    def subdomain(domain):
        return extractor(domain.lower().strip()).subdomain

    @staticmethod
    def subdomain_np(domain):
        return extractor(domain.lower().strip()).subdomain.replace('.', '')

    @staticmethod
    def subdomain_sfx(domain):
        exd = extractor(domain.lower().strip())
        return '.'.join([exd.subdomain, exd.suffix]) if exd.subdomain else exd.suffix

    @staticmethod
    def subdomain_sfx_np(domain):
        exd = extractor(domain.lower().strip())
        return (exd.subdomain + exd.suffix).replace('.','')

    def translator(self):
        return getattr(Transformer, str(self.name).lower())

    @staticmethod
    def checker(domain, check_suffix = False):
        exd = extractor(domain)
        print(check_suffix, '<%s>' % exd.suffix)
        if exd.suffix == '':
            if check_suffix:
                return False
            print("warning: no suffix for domain |%s|" % domain)
        return domain.find('.') >= 0

    @classmethod
    def all(cls):
        return [member for role, member in cls.__members__.items()]