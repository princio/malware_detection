from flask import Flask, request, send_from_directory
from windowed import get_html, get_bounds
from flask_cors import CORS, cross_origin
import json, os

app = Flask(__name__)
CORS(app)
DIR_CSV = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'csv')


@app.route('/df', methods=['POST'])
@cross_origin()
def windowed():
    ths = request.json['ths']
    body = get_html(request.json['size'], request.json['dga_gt'], request.json['dga'], request.json['th_measure'], ths, request.json['fxs'])
    return json.dumps(body)


@app.route('/csv/<string:filename>')
@cross_origin()
def send_json(filename):
    path = os.path.relpath(DIR_CSV)
    print(path)
    return send_from_directory(DIR_CSV, filename, as_attachment=False)


@app.route('/df/bounds', methods=['GET'])
@cross_origin()
def bounds():
    return json.dumps(get_bounds(json=True))


if __name__ == "__main__":
    app.run(port=3000, debug=True)