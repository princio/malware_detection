import csv
import numpy as np

def count_domain_level():

    path = 'datasets/setAtrain_h_t_domins.csv'

    dga = []
    legit = []

    domains_num = {
        'legit': np.zeros(10),
        'dga': np.zeros(6)
    }
    domains_level_num = {
        'legit': {0: {}, 1: {}, 2: {}, 3: {}, 4: {}, 5: {}},
        'dga': {0: {}, 1: {}, 2: {}, 3: {}, 4: {}, 5: {}}
    }
    domains_by_level_num = {
        'legit': {1: [], 2: [], 3: [], 4: [], 5: []},
        'dga': {1: [], 2: [], 3: [], 4: [], 5: []}
    }
    with open(path, "r") as f:
        reader = csv.reader(f)
        for row in reader:
            domain_levels = row[3].split('.')
            row.append(domain_levels)
            t = row[0]
            if t == 'legit':
                legit.append(row)
            else:
                dga.append(row)

            l_d_l = len(domain_levels)
            domains_by_level_num[t][l_d_l].append(row)

            domains_num[t][l_d_l] += 1

            domain_levels.reverse()
            for idx, l in enumerate(domain_levels):
                if l not in domains_level_num[t][idx]:
                    domains_level_num[t][idx][l] = 0
                domains_level_num[t][idx][l] += 1

    
    for t  in ['legit', 'dga']:
        # for l_n  in domains_level_num[t]:
        #     with open(f'{path}_domains_{l_n}_{t}.csv', "w") as f:
        #         writer = csv.writer(f)
        #         for domain_name in domains_level_num[t][l_n]:
        #             writer.writerow([domain_name, domains_level_num[t][l_n][domain_name]])
        for level_num in domains_by_level_num[t]:
            with open(f'{path}_rows_w_{level_num}_level_{t}.csv', "w") as f:
                writer = csv.writer(f)
                for r in domains_by_level_num[t][level_num]:
                    writer.writerow(r)
    pass


def inspect_alexa_domain_with_least_2_level():
    path = 'datasets/setAtrain_h_t_domins.csv'

    legit = []

    third_level = []
    with open(f'{path}_third_level_legit.csv', "w") as f:
        writer = csv.writer(f)
        with open(path, "r") as f:
            reader = csv.reader(f)
            for row in reader:
                domain_levels = row[3].split('.')
                row.append(domain_levels)
                t = row[0]
                if t == 'legit' and len(domain_levels) > 3:
                    third_level.append(row + domain_levels)
                    writer.writerow(row + domain_levels)

if __name__ == "__main__":
    # count_domain_level()
    inspect_alexa_domain_with_least_2_level()


    pass